import{key,app_name}from"../src/config.min.js";import{initStorage}from"../src/storage.min.js";import{initMenu}from"../src/menu.min.js";import{generateRandomPass}from"../src/aes.min.js";async function init(){const e=await findDomain();initStorage(key,(()=>{})),initMenu(document.body,app_name,"Parola başlığı ekleyiniz...","Parola Oluştur",e,{username:"",password:""},handleClick,(()=>generateRandomPass(20)))}function findDomain(){const e="NULL://";return new Promise((t=>{chrome.tabs.query({active:!0,currentWindow:!0},(function(n){try{const o=n[0];let r=new URL(o.url),i=r.protocol;r=r.hostname;const l=psl.parse(r);null!=l.domain&&(r=l.domain),"http:"!=i.toLowerCase()&&"https:"!=i.toLowerCase()&&(r=e),t(r)}catch{t(e)}}))}))}function handleClick(e,t){const n=t.username??null,o=t.password??null;chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.scripting.executeScript({target:{tabId:e[0].id},function:otomatik_doldur,args:[n,o]})})),window.close()}async function otomatik_doldur(e,t){const n=l(),o=u();let r;if(null!=n&&await s(n,e),null!=o&&await s(o,t),null!=n&&null!=n.form)r=n.form;else{if(null==o||null==o.form)return;r=o.form}let i=r.querySelector('button[type="submit"], input[type="submit"]');if(null==i){const e=r.querySelectorAll("button");1==e.length&&(i=e[0])}function l(){if(1!=document.querySelectorAll('input[type="password"]').length)return document.activeElement;const e=u(),t=document.getElementsByTagName("input");let n;for(n=0;n<t.length&&t[n]!=e;n++);for(let e=n;;e=(e-1+t.length)%t.length)if("hidden"!=t[e].type.toLowerCase()&&"password"!=t[e].type.toLowerCase())return t[e]}function u(){const e=document.querySelectorAll('input[type="password"]');if(0==e.length)return null;if(1==e.length)return e[0];const t=l(),n=document.getElementsByTagName("input");let o;for(o=0;o<n.length&&n[o]!=t;o++);for(let e=o;;e=(e+1)%n.length)if("password"==n[e].type.toLowerCase())return n[e]}async function s(e,t){return e.focus(),document.execCommand("selectAll",!1,"")&&document.execCommand("insertText",!1,t)||(e.value=t),e.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new Event("input",{bubbles:!0})),new Promise((e=>{setTimeout((()=>{e(1)}),100)}))}null!=i?i.click():r.submit()}init();